<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.QueryTableDAO">
  <select id="findById" resultType="QueryTable">
    select * from query_table where id =
    #{id}
  </select>
  
    <select id="query" resultType="QueryTable">
    select * from query_table as qt
    <where>
      <if test="query1 != null">
        AND qt.query1 = #{query1}
      </if>
      <if test="query2 != null">
        AND qt.query2 like concat('%', #{query2}, '%')
      </if>
       <if test="query3 != null">
        AND qt.query3 = #{query3}
      </if> 
     <if test="group1 != null">
        AND qt.group1 = #{group1}
      </if>
      <if test="query2 != null">
        AND qt.group2 like concat('%', #{group2}, '%')
      </if>
       <if test="group3 != null">
        AND qt.group3 = #{group3}
      </if> 
     </where>
  </select>
  
  <select id="group" parameterType="java.util.Map" resultType="hashmap">
    select count(*) as count,
    <foreach item="item" index="index" collection="map" open="" separator="," close="">
      <if test='item == true'>
         qt.`${index}`
      </if>
    </foreach>
    from query_table as qt
    group by
    <foreach item="item" index="index" collection="map" open="" separator="," close="">
      <if test='item == true'>
         qt.`${index}`
      </if>
    </foreach>
  </select>
  
  <select id="findAll" resultType="QueryTable">
    select * from query_table
  </select>

  <insert id="insert" keyProperty="id" useGeneratedKeys="true">
    insert into query_table(query1, query2, query3, group1, group2, group3)
    values (#{item.query1}, #{item.query2}, #{item.query3}, #{item.group1}, #{item.group2}, #{item.group3})
  </insert>
  
    <update id="update">
    UPDATE query_table SET 
      query1 = #{item.query1}, 
      query2 = #{item.query2}, 
      query3 = #{item.query3}, 
      group1 = #{item.group1}, 
      group2 = #{item.group2}, 
      group3 = #{item.group3}
    WHERE id = #{item.id}
  </update>
  
    <delete id="delete">
    DELETE FROM query_table WHERE id = #{id} LIMIT 1
  </delete>
</mapper>